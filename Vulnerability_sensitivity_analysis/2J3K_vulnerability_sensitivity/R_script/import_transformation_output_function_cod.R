


import_transformation_output_function_cod <- function(versions = c("2", "10", "100", "100000"), print = FALSE) {
  
  # Définition du dossier source des fichiers
  species_folder <- "cod_sim"
  
  # Génération des noms de fichiers pour chaque version
  file_list <- paste0("biomass_annual_cod_V", versions, "_F0.xlsx")
  
  # Construction des chemins complets
  file_paths <- file.path(here(species_folder), file_list)
  
  # Vérifier quels fichiers existent réellement avant de les importer
  existing_files <- file_paths[file.exists(file_paths)]
  
  if (length(existing_files) == 0) {
    stop("Aucun fichier trouvé dans ", species_folder)
  }
  
  # Lire les fichiers existants
  all_data <- lapply(existing_files, openxlsx::read.xlsx)
  
  # Transformation des données
  list_of_dataframes <- map2(all_data, existing_files, function(simulation_data, file_path) {
    
    # Extraire un nom de variable unique à partir du nom de fichier
    var_name <- gsub(".xlsx", "", basename(file_path))
    
    # Transformer la table
    simulation_data <- simulation_data %>% 
      filter(row_number() %in% c(8, n())) %>% 
      t() %>% 
      as_tibble() %>%
      rename(Group_number = V1, !!var_name := V2) %>% 
      slice(-1) %>%
      mutate(Group_number = as.integer(Group_number))
    
    return(simulation_data)
  })
  
  # Fusionner tous les fichiers en un seul
  Df_merged <- reduce(list_of_dataframes, left_join, by = "Group_number") %>%
    left_join(group_name_key, by = "Group_number")  # Assure-toi que `group_name_key` est bien chargé
  
  # Stocker dans l'environnement global
  assign("Df_merged_cod_vulnerability", Df_merged, envir = .GlobalEnv)
  
  # Optionnel : afficher le résultat
  if (print) {
    print(Df_merged)
  }
}