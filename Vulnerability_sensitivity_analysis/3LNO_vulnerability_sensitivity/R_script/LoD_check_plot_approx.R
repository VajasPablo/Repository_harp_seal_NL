LoD_check_plot_approx <- function(data, observed_biomass, Fspecies, species, species_chrc, version, Group_number_specific) {
  
  # Transformer la table pour avoir un format long
  LoD <- data %>%
    filter(Group_number %in% Group_number_specific) %>%
    select(-c(Group_number, Group_name)) %>%
    pivot_longer(cols = everything(), 
                 names_to = "F_sim", 
                 values_to = "F_sim_value") %>%
    mutate(
      F_sim_value = as.numeric(F_sim_value),  
      F_sim = gsub(paste0("biomass_annual_fitted_", version, "_", species_chrc, "_"), "", F_sim),  # Suppression du préfixe
      F_depletion = paste0(F_sim, "_Depletion"),
      F_depletion_value = round(abs(((F_sim_value - F_sim_value[1]) / F_sim_value[1]) * 100), 2)
    )
  
  # Extraction directe de la colonne F0
  F0_column <- paste0("biomass_annual_fitted_", version, "_", species_chrc, "_F0")
  
  if (!(F0_column %in% colnames(data))) {
    stop("Impossible de trouver la colonne F0 : ", F0_column, "\nVérifie les noms de colonnes disponibles :\n", 
         paste(colnames(data), collapse = ", "))
  }
  
  F0 <- data %>%
    filter(Group_number %in% Group_number_specific) %>%
    pull(F0_column) %>%
    as.numeric()
  
  # Calcul de l'observed LoD
  observed_LoD <- ((F0 - observed_biomass) / F0) * 100
  
  # Graphique 1 : Observations
  obsggplot <- ggplot(LoD, aes(x = F_depletion_value, y = F_sim)) +
    geom_point() +
    labs(x = "Level of Depletion", y = "F rate", 
         title = paste0(species, " (", version, "): Plot of % depletion vs. F rate")) +
    theme_bw() +
    geom_vline(xintercept = observed_LoD, color = "yellow3") +
    annotate("text", x = observed_LoD, y = 1, label = round(observed_LoD, 2), 
             vjust = 1, hjust = -0.2, color = "yellow3", size = 6) +
    theme(axis.title.x = element_text(size = 14),
          axis.title.y = element_text(size = 14),
          axis.text.x = element_text(size = 12),
          axis.text.y = element_text(size = 12),
          plot.title = element_text(size = 16),
          legend.text = element_text(size = 12))
  
  # INTERPOLATED VALUE PART
  LoD_fixe <- c(0.00, 10.00, 20.00, 25.00, 30.00, 40.00, 50.00, 60.00, 70.00, 75.00, 80.00, 90.00, 99.00)
  
  LoD_numeric <- LoD %>%
    select(F_sim, F_depletion_value) %>%
    mutate(F_sim = as.numeric(gsub("[^0-9.]+", "", F_sim)))
  
  # Appliquer l'interpolation pour chaque LoD_fixe
  result_df <- do.call(rbind, lapply(LoD_fixe, function(x) {
    interpolated_values <- approx(LoD_numeric$F_depletion_value, LoD_numeric$F_sim, xout = x)$y
    data.frame(Fixed_LoD = x, F_mortality_interpolated = interpolated_values)
  }))
  
  # Graphique 2 : Approximation
  approxggplot <- ggplot(LoD_numeric, aes(x = F_depletion_value, y = F_sim)) +
    geom_point(color = "darkblue") +
    geom_line(aes(group = 1), linetype = "solid", color = "gray") +
    geom_point(data = result_df, aes(x = Fixed_LoD, y = F_mortality_interpolated), color = "red") +
    geom_line(data = result_df, aes(x = Fixed_LoD, y = F_mortality_interpolated), linetype = "dashed", color = "red") +
    labs(x = "Level of Depletion", y = "F rate",
         title = paste0(species, " (", version, "): Plot of % depletion vs. F rate with \nin red approximation results")) +
    theme_bw() +
    theme(axis.title.x = element_text(size = 14),
          axis.title.y = element_text(size = 14),
          axis.text.x = element_text(size = 12),
          axis.text.y = element_text(size = 12),
          plot.title = element_text(size = 16),
          legend.text = element_text(size = 12))
  
  # Affichage des plots
  grid.arrange(obsggplot, approxggplot, ncol = 2)
  
  # Stockage du résultat dans l'environnement global
  assign(paste0("Df_LoD_fixed_", species_chrc, "_", version), result_df, envir = .GlobalEnv)
}
