

compare_sensitivity <- function(data1, data2) {
  
  # Vérifier que les tables ont bien la même longueur
  if (nrow(data1) != nrow(data2)) {
    stop("Les tableaux de référence et de sensibilité n'ont pas la même longueur.")
  }
  
  # Séparer les colonnes d'identification
  id_columns <- data1 %>% select(Group_name)
  
  # Sélectionner uniquement les colonnes numériques et les convertir en numeric
  numeric_cols1 <- data1 %>% select(-Group_number, -Group_name) %>% mutate(across(everything(), as.numeric))
  numeric_cols2 <- data2 %>% select(-Group_number, -Group_name) %>% mutate(across(everything(), as.numeric))
  
  # Vérifier que les dimensions sont identiques
  if (!all(dim(numeric_cols1) == dim(numeric_cols2))) {
    stop("Les tableaux n'ont pas la même structure.")
  }
  
  # Calcul du pourcentage de changement avec gestion des valeurs NA
  comparison_table <- round((numeric_cols2 - numeric_cols1) / numeric_cols1 * 100, 2)
  
  # Remplacer les NA par 0 correctement
  comparison_table <- comparison_table %>% mutate(across(everything(), ~ replace_na(.x, 0)))
  
  # Standardiser les noms de colonnes
  colnames(comparison_table) <- paste0("Sim_", seq_along(comparison_table))
  
  # Réassembler avec les identifiants
  comparison_table <- id_columns %>% bind_cols(comparison_table)
  
  return(comparison_table)
}